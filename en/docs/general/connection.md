---
title: 外部連線
---

外部連線
========

不論你使用的驅動程式為何，我們都認為你應該以「單例」的方式管理專案所依賴的外部連線實體，比如：DB, Cache 或是任何需要長連線的外部系統。

這是因為，每個 Worker 都會長時間地存活在記憶體中重複地處理 HTTP 請求，這使的我們降低了 PHP 重複編譯與載入的效能開銷。倘若外部連線實體會在每一個請求開始時重新連線，這將會大大地拖慢執行效能。

Burner 將在伺服器啟動後接管 CodeIgniter4 的生命週期，在長連線管理中，我們只針對 Codeigniter4 內建的 `Database` 程式庫與 `Cache` 程式庫進行直接支援，並不保證 PHP 內建的方法是否能照常運作。

對此，你應該避免使用內建的 PHP 方法，而是以 Codeigniter4 框架內建的程式庫為主。

{% info 備註 %}

當然，若是你十分熟悉你所選擇的驅動程式與你需要長連線的目標系統，也可以自行處理連線，使其能長時間地留存在記憶體中。

{% end %}

## 資料庫與快取程式庫

在 Burner 的預設設定中， Worker 的資料庫與快取的連線是持久的，並會在連線失效時自動重新連線。所有進入 Worker 的請求都將使用同一個連線實體。

如果你不想要這個預設設定，希望每個進入 Worker 的請求都使用重新連線的 DB 或 Cache 連線實體。請調整 Config/Burner.php 中的下列設定：

```php
public $dbAutoClose = true;
public $cacheAutoClose = true;
```