<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>RoadRunner Implement</title>
    <meta name="description" content="Documentation for CodeIgniter Burner Beta3">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/en/assets/normalize.css?v=1698677921"
        media="screen" />
    <link rel="stylesheet" type="text/css" href="/en/assets/doctave-style.css?v=1698677921"
        media="screen" />
    <link rel="stylesheet" type="text/css" href="/en/assets/katex.css?v=1698677921" media="screen" />
    <link rel="stylesheet" type="text/css" href="/en/assets/prism-ghcolors.css?v=1698677921"
        media="screen" />

    <script>
        var DOCTAVE_TIMESTAMP = "1698677921";
        var BASE_PATH = "/en/";
        var color = localStorage.getItem('doctave-color')

        if (color === 'dark') {
            document.getElementsByTagName('html')[0].classList.remove('light');
            document.getElementsByTagName('html')[0].classList.add('dark');
        } else {
            document.getElementsByTagName('html')[0].classList.remove('dark');
            document.getElementsByTagName('html')[0].classList.add('light');
        }
    </script>

    
    <link rel="icon" type="image/x-icon" href="/favicon.ico"> 
<script>
    document.title = 'CodeIgniter Burner - ' + document.title;
</script>
    
</head>

<body>
    <label for='menu-toggle-switch' class='menu-toggle-button'>
        â˜°
    </label>
    <input type="checkbox" id="menu-toggle-switch" value='0' />
    <div class='page'>
        <div class='header'>
            <div class='logo'>
                
                <a href="/en/">
                    <img src="/en/logo.png" alt='CodeIgniter Burner Beta3 logo'></img>
                </a>
                
                <h2 class='project-name'>
                    <a href="/en/">
                        CodeIgniter Burner Beta3
                    </a>
                </h2>
            </div>
            <div class='search'>
                <form id='search-form'>
    <input type='text' id='search-box' autocomplete="off" placeholder="Search..."></input>
    <span class='search-icon'>S</span>
    <ul id='search-results'></ul>
</form>

            </div>
            <div class='header-dummy-right'>
            </div>
        </div>
        <div class='container'>
            <div class='sidebar-left'>
                <nav class='site-nav'>
    <ul>
        
            <li><a href="/en/introduction">Welcome to Burner!</a></li>
            
        
            <li><a href="/en/general">General</a></li>
            
                <ul>
    
        <li><a href="/en/general/quickstart">Quickstart</a></li>
        
    
        <li><a href="/en/general/suggestion">Development Suggestion</a></li>
        
    
        <li><a href="/en/general/docker">Docker Environment</a></li>
        
    
</ul>

            
        
            <li><a href="/en/openswoole">OpenSwoole</a></li>
            
                <ul>
    
        <li><a href="/en/openswoole/implement">OpenSwoole Implement</a></li>
        
    
        <li><a href="/en/openswoole/suggestion">OpenSwoole Suggestion</a></li>
        
    
        <li><a href="/en/openswoole/commands">OpenSwoole Commands</a></li>
        
    
</ul>

            
        
            <li><a href="/en/roadrunner">RoadRunner</a></li>
            
                <ul>
    
        <li><a class="active" href="/en/roadrunner/implement">RoadRunner Implement</a></li>
        
    
        <li><a href="/en/roadrunner/suggestion">RoadRunner Suggestion</a></li>
        
    
        <li><a href="/en/roadrunner/commands">RoadRunner Commands</a></li>
        
    
</ul>

            
        
            <li><a href="/en/workerman">Workerman</a></li>
            
                <ul>
    
        <li><a href="/en/workerman/implement">Workerman Implement</a></li>
        
    
        <li><a href="/en/workerman/suggestion">Workerman Suggestion</a></li>
        
    
        <li><a href="/en/workerman/commands">Workerman Commands</a></li>
        
    
</ul>

            
        
    </ul>
    <span id='light-dark-mode-switch'>
        <svg xmlns="http://www.w3.org/2000/svg" id="dark-mode-icon" viewBox="0 0 20 20" fill="currentColor">
            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
        </svg>

        <svg xmlns="http://www.w3.org/2000/svg" id="light-mode-icon" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />
        </svg>
    </span>
</nav>

            </div>
            <div class='doctave-content'>
                <h1 id="roadrunner-http">RoadRunner HTTP</h1>
<p>RoadRunner is a complete PHP server, we can integrate it with Burner-Core without writing any special logic. If you choose RoadRunner as your server solution, you will hardly notice it in development.</p>
<p>The key part of worker.php is as follows:</p>
<pre><code class="language-php">while (true) {
    // get psr7 request
    try {
        $request = $psr7-&gt;waitRequest();
        if (! ($request instanceof RequestInterface)) { // Termination request received
            break;
        }
    } catch (Exception $e) {
        $psr7-&gt;respond(new Response(400)); // Bad Request

        continue;
    }

    /** @var \Psr\Http\Message\ResponseInterface */
    $response = \Monken\CIBurner\App::run($request);

    // handle response object
    try {
        $psr7-&gt;respond($response);
        Events::trigger('burnerAfterSendResponse', $psr7);
        \Monken\CIBurner\App::clean();
    } catch (Exception $e) {
        $psr7-&gt;respond(new Response(500, [], 'Something Went Wrong!'));
    }
}
</code></pre>
<p>All HTTP requests start from the <code>waitRequest</code> method, when this method gets the latest user request, it will immediately execute the <code>App::run()</code> method, and Burner will start a series of preprocessing and notify CodeIgniter4 to handle your connection.</p>
<p>Next, you will enter the CodeIgniter4 processing process, when CodeIgniter4 processing is complete, the <code>run()</code> method will return a PSR-7 response object, and transfer it to the <code>respond</code> method for processing.</p>
<p>After understanding the above process, you will find that the implementation logic of RoadRunner is not complicated, just like you are familiar with, develop your application as usual.</p>
<h2 id="events">Events</h2>
<p>CodeIgniter4 provides <a href="https://codeigniter.com/user_guide/extending/events.html">events</a> that can be used to perform actions at specific points during execution. When CodeIgniter runs, it follows a certain execution order, but in some cases, you may want to perform some actions at a specific stage of execution.</p>
<p>Burner provides the following events for OpenSwoole HTTP:</p>
<h3 id="burneraftersendresponse">burnerAfterSendResponse</h3>
<p>This is usually used to initialize after the response, if you have some global variables that need to be cleared or some common processing after the response, it is very suitable to declare it in this event. You can declare the <code>burnerAfterSendResponse</code> event, and when OpenSwoole responds, the logic you need to execute will be executed:</p>
<pre><code class="language-php">// This code will be executed after sending the response to the client.
Events::on('burnerAfterSendResponse',static function(\Spiral\RoadRunner\Http\PSR7Worker $psr7Worker)
{
    //Your logic
});
</code></pre>
<p>The way events are used is not limited to callback functions. Please refer to the methods mentioned in the <a href="https://codeigniter.com/user_guide/extending/events.html#defining-an-event">CodeIgniter4 User Guide</a> to choose the best way for you.</p>
<h2 id="configuration">Configuration</h2>
<p>The automatically generated configuration file of Burner will be located in the root directory of the project under <code>rr.yml</code>, and its content may be as follows:</p>
<pre><code class="language-yml">version: "2.7"

rpc:
  listen: tcp://127.0.0.1:6001

server:
  command: "php Worker.php -f=/app/CodeIgniter4-Burner/src/FrontLoader.php -a=/app/CodeIgniter4-Burner/dev/app/"
  # env:
  #   XDEBUG_SESSION: 1

http:
  address: "0.0.0.0:8080"
  static:
    dir: "/app/CodeIgniter4-Burner/dev/public"
    forbid: [".htaccess", ".php"]
  pool:
    num_workers: 1
    # max_jobs: 64
    # debug: true

# reload:
#   interval: 1s
#   patterns: [ ".php" ]
#   services:
#     http:
#       recursive: true
#       ignore: [ "vendor" ]
#       patterns: [ ".php", ".go", ".dmd" ]
#       dirs: [ "/app/CodeIgniter4-Burner/dev" ]

# logs:
#   mode: development
#   output: stdout
#   file_logger_options:
#     log_output: "/app/CodeIgniter4-Burner/dev/writable/logs/RoadRunner.log"
#     max_size: 100
#     max_age: 1
#     max_backups : 5
#     compress: false
</code></pre>
<p>You may find that in the configuration of <code>server.command</code>, we use <code>php Worker.php -f -a</code> to start the RoadRunner Worker, this is because we need to load the CodeIgniter4 core in the Worker, and this core needs to be handled by the <code>FrontLoader</code> provided by Burner.</p>
<p>At the same time, the location of the <code>app</code> folder is also very important for CodeIgniter4, so we need to pass these two parameters when starting the Worker, and these two parameters will be automatically generated by the Burner initialization command.</p>
<p>You can refer to the <a href="https://github.com/roadrunner-server/roadrunner/blob/v2.12.3/.rr.yaml">official full version document</a> and <a href="https://roadrunner.dev/docs">official user manual</a> according to your own needs to modify this file.</p>

            </div>
            <div class='sidebar-right'>
                <div class='page-nav' id='page-nav'>
                    <p class='page-nav-header'>On this page</p>
                    <ul>
                        
                        <li class='page-nav-level-1'>
                            <a href='#roadrunner-http'>RoadRunner HTTP</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#events'>Events</a>
                        </li>
                        
                        <li class='page-nav-level-3'>
                            <a href='#burneraftersendresponse'>burnerAfterSendResponse</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#configuration'>Configuration</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
            <div class='wave-container'>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
                    <path fill-opacity="0.35"
                        d="M0,192L60,213.3C120,235,240,277,360,277.3C480,277,600,235,720,192C840,149,960,107,1080,122.7C1200,139,1320,213,1380,250.7L1440,288L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z">
                    </path>
                    <path fill-opacity="0.5"
                        d="M0,160L60,181.3C120,203,240,245,360,229.3C480,213,600,139,720,138.7C840,139,960,213,1080,229.3C1200,245,1320,203,1380,181.3L1440,160L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z">
                    </path>
                    <path fill-opacity="0.2"
                        d="M0,224L60,197.3C120,171,240,117,360,117.3C480,117,600,171,720,186.7C840,203,960,181,1080,186.7C1200,192,1320,224,1380,240L1440,256L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z">
                    </path>
                </svg>
                <p>Powered by <a href='https://cli.doctave.com' target='_blank'>Doctave</a></p>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="/en/assets/katex.js?v=1698677921"></script>
    <script type="text/javascript" src="/en/assets/mermaid.js?v=1698677921"></script>
    <script type="text/javascript" src="/en/assets/elasticlunr.js?v=1698677921"></script>
    <script type="text/javascript" src="/en/assets/prism.js?v=1698677921"></script>
    <script type="text/javascript" src="/en/assets/doctave-app.js?v=1698677921"></script>

    
</body>

</html>