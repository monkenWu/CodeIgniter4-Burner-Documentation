<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Development Suggestion</title>
    <meta name="description" content="Documentation for CodeIgniter Burner Beta2">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/en/assets/normalize.css?v=1687409263"
        media="screen" />
    <link rel="stylesheet" type="text/css" href="/en/assets/doctave-style.css?v=1687409263"
        media="screen" />
    <link rel="stylesheet" type="text/css" href="/en/assets/katex.css?v=1687409263" media="screen" />
    <link rel="stylesheet" type="text/css" href="/en/assets/prism-ghcolors.css?v=1687409263"
        media="screen" />

    <script>
        var DOCTAVE_TIMESTAMP = "1687409263";
        var BASE_PATH = "/en/";
        var color = localStorage.getItem('doctave-color')

        if (color === 'dark') {
            document.getElementsByTagName('html')[0].classList.remove('light');
            document.getElementsByTagName('html')[0].classList.add('dark');
        } else {
            document.getElementsByTagName('html')[0].classList.remove('dark');
            document.getElementsByTagName('html')[0].classList.add('light');
        }
    </script>

    
    <link rel="icon" type="image/x-icon" href="/favicon.ico"> 
<script>
    document.title = 'CodeIgniter Burner - ' + document.title;
</script>
    
</head>

<body>
    <label for='menu-toggle-switch' class='menu-toggle-button'>
        â˜°
    </label>
    <input type="checkbox" id="menu-toggle-switch" value='0' />
    <div class='page'>
        <div class='header'>
            <div class='logo'>
                
                <a href="/en/">
                    <img src="/en/logo.png" alt='CodeIgniter Burner Beta2 logo'></img>
                </a>
                
                <h2 class='project-name'>
                    <a href="/en/">
                        CodeIgniter Burner Beta2
                    </a>
                </h2>
            </div>
            <div class='search'>
                <form id='search-form'>
    <input type='text' id='search-box' autocomplete="off" placeholder="Search..."></input>
    <span class='search-icon'>S</span>
    <ul id='search-results'></ul>
</form>

            </div>
            <div class='header-dummy-right'>
            </div>
        </div>
        <div class='container'>
            <div class='sidebar-left'>
                <nav class='site-nav'>
    <ul>
        
            <li><a href="/en/introduction">Welcome to Burner!</a></li>
            
        
            <li><a href="/en/general">General</a></li>
            
                <ul>
    
        <li><a href="/en/general/quickstart">Quickstart</a></li>
        
    
        <li><a class="active" href="/en/general/suggestion">Development Suggestion</a></li>
        
    
        <li><a href="/en/general/docker">Docker Environment</a></li>
        
    
</ul>

            
        
            <li><a href="/en/openswoole">OpenSwoole</a></li>
            
                <ul>
    
        <li><a href="/en/openswoole/implement">OpenSwoole Implement</a></li>
        
    
        <li><a href="/en/openswoole/suggestion">OpenSwoole Suggestion</a></li>
        
    
        <li><a href="/en/openswoole/commands">OpenSwoole Commands</a></li>
        
    
</ul>

            
        
            <li><a href="/en/roadrunner">RoadRunner</a></li>
            
                <ul>
    
        <li><a href="/en/roadrunner/implement">RoadRunner Implement</a></li>
        
    
        <li><a href="/en/roadrunner/suggestion">RoadRunner Suggestion</a></li>
        
    
        <li><a href="/en/roadrunner/commands">RoadRunner Commands</a></li>
        
    
</ul>

            
        
            <li><a href="/en/workerman">Workerman</a></li>
            
                <ul>
    
        <li><a href="/en/workerman/implement">Workerman Implement</a></li>
        
    
        <li><a href="/en/workerman/suggestion">Workerman Suggestion</a></li>
        
    
        <li><a href="/en/workerman/commands">Workerman Commands</a></li>
        
    
</ul>

            
        
    </ul>
    <span id='light-dark-mode-switch'>
        <svg xmlns="http://www.w3.org/2000/svg" id="dark-mode-icon" viewBox="0 0 20 20" fill="currentColor">
            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
        </svg>

        <svg xmlns="http://www.w3.org/2000/svg" id="light-mode-icon" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />
        </svg>
    </span>
</nav>

            </div>
            <div class='doctave-content'>
                <h1 id="development-suggestion">Development Suggestion</h1>
<h2 id="using-codeigniter4-request-and-response-object">Using Codeigniter4 Request and Response object</h2>
<p>Codeigniter4 does not implement the complete <a href="https://www.php-fig.org/psr/psr-7/">HTTP message interface</a>, hence this library focuses on the synchronize of <code>PSR-7 interface</code> and <code>Codeigniter4 HTTP interface</code>.</p>
<p>Base on the reasons above, You should use <code>$this-&gt;request</code>, provided by Codeigniter4, or the global function <code>/Config/Services::('request')</code> to fetch the correct request object; Use <code>$this-&gt;response</code> or <code>/Config/Services::('response')</code> to fetch the correct response object.</p>
<p>Please be noticed, while constructing response for the users during developing, you should prevent using PHP built-in methods to conduct <code>header</code> or <code>set-cookies</code> settings. Using the <code>setHeader()</code> and <code>setCookie()</code>, provided by the <a href="https://codeigniter.com/user_guide/outgoing/response.html">Codeigniter4 Response Object</a>, to conduct setting.</p>
<h2 id="use-return-to-stop-controller-logic">Use return to stop controller logic</h2>
<p>Inside the Controller, try using return to stop the controller logic. No matter the response of view or API, reduce the <code>echo</code> output usage can avoid lets of errors, just like this:</p>
<pre><code class="language-php">&lt;?php

namespace App\Controllers;

use CodeIgniter\API\ResponseTrait;

class Home extends BaseController
{
	use ResponseTrait;

	public function index()
	{
		//Don't use :
		//echo view('welcome_message');
		return view('welcome_message');
	}

	/**
	 * send header
	 */
	public function sendHeader()
	{
		$this-&gt;response-&gt;setHeader("X-Set-Auth-Token",uniqid());
		return $this-&gt;respond(["status"=&gt;true]);
	}

}
</code></pre>
<h2 id="use-the-built-in-session-library">Use the built-in Session library</h2>
<p>We only focus on supporting the Codeigniter4 built-in <a href="https://codeigniter.com/user_guide/libraries/sessions.html">Session library</a>, and do not guarantee if using <code>session_start()</code> and <code>$_SEEEION</code> can work as normal. So, you should avoid using the PHP built-in Session method, change to the Codeigniter4 framework built-in library.</p>
<h2 id="external-connections">External Connections</h2>
<p>No matter what driver you are using, we believe that you should manage the external connections in a singleton way, such as: DB, Cache or any other external systems that need long connections.</p>
<p>This is because each Worker will live in memory for a long time to repeatedly process HTTP requests, which makes us reduce the performance overhead of PHP repeated compilation and loading. If the external connection instance will reconnect at the beginning of each request, this will greatly slow down the execution performance.</p>
<p>Burner will take over the life cycle of CodeIgniter4 after the server starts, and in the long connection management, we only directly support the Codeigniter4 built-in <code>Database</code> library and <code>Cache</code> library, and do not guarantee that the built-in PHP method will work as normal.</p>
<p>For this, you should avoid using the built-in PHP method, and use the Codeigniter4 framework built-in library as the main.</p>
<div class="callout info"><p class="callout-title">Note</p>
<p>Of course, if you are very familiar with the driver you choose and the target system you need to connect to, you can also handle the connection yourself to keep it in memory for a long time.</p>
</div><h3 id="database-and-cache-library">Database and Cache Library</h3>
<p>In the default settings of Burner, the connection of the Worker's database and cache is persistent, and will automatically reconnect when the connection is invalid. All requests that enter the Worker will use the same connection instance.</p>
<p>If you do not want this default setting, and want each request that enters the Worker to use a DB or Cache connection instance that reconnects. Please adjust the following settings in Config/Burner.php:</p>
<pre><code class="language-php">public $dbAutoClose = true;
public $cacheAutoClose = true;
</code></pre>
<h2 id="file-upload">File Upload</h2>
<p>Burner will reassign the uploaded file information in the request to <code>$_FILES</code>, so the <a href="https://codeigniter.com/user_guide/libraries/uploaded_files.html">File Upload Class</a> of Codeingiter4 can work properly. However, the built-in PHP file upload processing methods, such as: <code>move_uploaded_file()</code> or <code>is_uploaded_file()</code>, these methods will not work properly in the persistent PHP server. Therefore, you will not be able to use CodeIgniter4's <a href="https://codeigniter.com/user_guide/libraries/uploaded_files.html#moving-files"><code>$file-&gt;move()</code></a> method to process the files uploaded by the user.</p>
<div class="callout info"><p class="callout-title">Note</p>
<p>
If you are using the <code>OpenSwoole</code> driver, you can use all the file upload processing methods normally.
</p>
</div>
<p>We recommend that you handle file uploads in the Controller in the following ways:</p>
<pre><code class="language-php">public function fileUpload()
{
    /**
     * @var \CodeIgniter\HTTP\Files\UploadedFile[]
     */
    $files = $this-&gt;request-&gt;getFiles();    
    foreach ($files as $file) {
        $newFileName = $file-&gt;getRandomName();
        $newFileNamePath = WRITEPATH . 'uploads' . DIRECTORY_SEPARATOR . $newFileName;
        if(BURNER_DRIVER == 'OpenSwoole'){
            // if you use OpenSwoole driver, you can use move()
            if ($file-&gt;isValid() &amp;&amp; ! $file-&gt;hasMoved()) {
                $file-&gt;move(WRITEPATH . 'uploads' , $newFileName);
            }
        }else{
            // if you use RoadRunner or Workerman driver, you should use rename(or other method) to move file to new path.
            if (!$file-&gt;hasMoved()) {
                rename($file-&gt;getTempName(), $newFileNamePath);
            }
        }
    }
</code></pre>
<h2 id="service-management">Service Management</h2>
<p>CodeIgniter4 provides <a href="https://codeigniter.com/user_guide/concepts/services.html">Services</a> to allow us to share object instances throughout the project. Burner will take over the life cycle of the Service after the server starts. After each request is processed, Burner will automatically release the object instance of the Service and re-establish the object instance of the Service in the next request.</p>
<p>If you have implemented your own Service object, or you think that some Service objects do not need to be re-established, you can set it in the <code>$skipInitServices</code> array in <code>app/Config/Burner.php</code>:</p>
<pre><code class="language-php">public $skipInitServices = [
    // type service name here
    'validation',
];
</code></pre>
<p>After you add the service name to the <code>$skipInitServices</code> array, Burner will not clear the object instance of the service on each request. At this time, you need to handle the life cycle of the Service object you set yourself.</p>
<h2 id="worker-num">Worker-num</h2>
<p>Because RoadRunner, OpenSwoole and Workerman are fundamentally different from other server software (Nginx, Apache), each Codeigniter4 will be persisted in memory in the form of a Worker, and the HTTP request will be repeatedly reused to handle these Workers. So, we should develop and test software in a single Worker environment to prove that it can work properly in a real environment with multiple Wokers.</p>
<h2 id="handle-variable-dump">Handle variable dump</h2>
<p>If you encountered some variables or object content that needed to be confirmed in <code>-d</code> development mode, you can use the global function <code>dump()</code> to throw errors onto the terminal no matter where the program is.</p>

            </div>
            <div class='sidebar-right'>
                <div class='page-nav' id='page-nav'>
                    <p class='page-nav-header'>On this page</p>
                    <ul>
                        
                        <li class='page-nav-level-1'>
                            <a href='#development-suggestion'>Development Suggestion</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#using-codeigniter4-request-and-response-object'>Using Codeigniter4 Request and Response object</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#use-return-to-stop-controller-logic'>Use return to stop controller logic</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#use-the-built-in-session-library'>Use the built-in Session library</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#external-connections'>External Connections</a>
                        </li>
                        
                        <li class='page-nav-level-3'>
                            <a href='#database-and-cache-library'>Database and Cache Library</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#file-upload'>File Upload</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#service-management'>Service Management</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#worker-num'>Worker-num</a>
                        </li>
                        
                        <li class='page-nav-level-2'>
                            <a href='#handle-variable-dump'>Handle variable dump</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
            <div class='wave-container'>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
                    <path fill-opacity="0.35"
                        d="M0,192L60,213.3C120,235,240,277,360,277.3C480,277,600,235,720,192C840,149,960,107,1080,122.7C1200,139,1320,213,1380,250.7L1440,288L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z">
                    </path>
                    <path fill-opacity="0.5"
                        d="M0,160L60,181.3C120,203,240,245,360,229.3C480,213,600,139,720,138.7C840,139,960,213,1080,229.3C1200,245,1320,203,1380,181.3L1440,160L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z">
                    </path>
                    <path fill-opacity="0.2"
                        d="M0,224L60,197.3C120,171,240,117,360,117.3C480,117,600,171,720,186.7C840,203,960,181,1080,186.7C1200,192,1320,224,1380,240L1440,256L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z">
                    </path>
                </svg>
                <p>Powered by <a href='https://cli.doctave.com' target='_blank'>Doctave</a></p>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="/en/assets/katex.js?v=1687409263"></script>
    <script type="text/javascript" src="/en/assets/mermaid.js?v=1687409263"></script>
    <script type="text/javascript" src="/en/assets/elasticlunr.js?v=1687409263"></script>
    <script type="text/javascript" src="/en/assets/prism.js?v=1687409263"></script>
    <script type="text/javascript" src="/en/assets/doctave-app.js?v=1687409263"></script>

    
</body>

</html>